<!DOCTYPE html>
<html>
<head>
	<title>USUARIOS</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
	<link href="$contextPath/css/chosen.min.css" rel="stylesheet" type="text/css"/>
	<script src="$contextPath/js/chosen.jquery.min.js" type="text/javascript"></script>
</head>
<body>
	#parse("header.vm")
	<div class="container">
		<div class="panel panel-default">
			<div class="panel-heading">USUARIOS</div>
			<div class="panel-body">
				<form class="form-horizontal" action="$contextPath/json/usuario/save" method="POST">
					<input type="hidden" name="id" value="$!user.id">	
					<div class="form-group">
						<label class="control-label col-md-2" for="correo">*Correo</label>
						<div class="col-md-4">
							<input type="text" value="$!user.correo" class="form-control input-sm" id="correo" name="correo" required>
						</div>
					</div>

					#if(!$user)
					<div class="form-group">
						<label class="control-label col-md-2" for="password">*Password</label>
						<div class="col-md-4">
							<input type="password" value="" class="form-control input-sm" id="password" name="password" required>
						</div>
					</div>
					#end

					#if(!$user)
					<div class="form-group">
						<label class="control-label col-md-2" for="persona">Persona</label>
						<div class="col-md-4">								
							<select name="persona_id" data-placeholder="Selecciona una persona" class="form-control input-sm chosen-select" style="width:350px;" tabindex="2" id="persona_id">
								#foreach($persona in $personas)
								#if($user.persona.id!=$persona.id)
								<option value="$!persona.id">$!persona.nombre $!persona.appaterno $!persona.apmaterno 
									/ $!persona.puesto.nombre / $!persona.puesto.area.nombre</option>
									#else
									<option value="$!persona.id" selected>$!persona.nombre $!persona.appaterno $!persona.apmaterno / $!persona.puesto.nombre / $!persona.puesto.area.nombre</option>
									#end
									#end
								</select>
							</div>
						</div>					
						#else
						<div class="form-group">
							<label class="control-label col-md-2" for="persona">Persona</label>
							<div class="col-md-4">
								<input type="text" value="$!user.persona.nombre $!user.persona.appaterno $!user.persona.apmaterno " class="form-control input-sm" id="persona" name="persona" readonly>
							</div>
						</div>
						#end

						<div class="form-group">
							<label class="control-label col-md-2" for="persona">Roles</label>
							<div class="col-md-4">
								#foreach($rol in $roles)
								#if($user.hasRol($rol.nombre))
								<input type="checkbox" name="roles" value="$rol.id" checked> $rol.nombre<br>
								#else
								<input type="checkbox" name="roles" value="$rol.id"> $rol.nombre<br>
								#end								
								#end
							</div>
						</div>

						<div class="form-group">
							<div class="col-md-offset-2 col-md-10">
								<button type="submit" class="btn btn-default">Aceptar</button>
							</div>
						</div>
					</form>
				</div>
			</div>
		</div>

		<script type="text/javascript">
			$(document).ready(function() {
				$(".chosen-select").chosen();
				$("form").submit(function(event) {
					event.preventDefault();
					$.ajax({
						type : "POST",
						url : $(this).attr('action'),
						data : $(this).serialize(),
						success : function(data) {
							if (data == 1) {
								window.location.href = '$contextPath/html/usuario/index';
							} else {
								alert('Hubo un error al actualizar los datos');
							}
						}
					});
				});
			});
		</script>


	</body>
	</html>
